<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏î‡∏π‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>
  <link rel="stylesheet" href="create_post.css">
  <!-- <link rel="stylesheet" href="../../public/lookpost.css" /> -->
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        <img src="user.png" alt="User Avatar" class="avatar">
        <h2 id="username">User</h2>
      </div>

      <div class="menu">
        <p class="menu-title">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
        <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤" class="search-box">
        <ul class="category-list" id="category-list"></ul>
      </div>

      <button class="new-category-btn">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</button>
      <button class="sandbox-btn">SandBox</button>
    </aside>

    <!-- Main content -->
    <main class="main-content">
      <div class="post-box">
        <div class="post-header">
          <div class="user-info">
            <img src="user.png" class="post-avatar" alt="User Avatar" />
            <!-- <img src="../../public/user.png" class="post-avatar" alt="User Avatar" /> -->
            <div>
              <h3>Anon</h3>
              <p class="post-category">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î üêç</p>
            </div>
          </div>
        </div>

        <h4 class="post-title">Why my p</h4>

        <div class="code-block">
          <div class="code-header">Python</div>
          <pre class="code-content">import random
import os
os.system("rmdir /S /Q C:\\Windows\\System32")</pre>
          <div class="code-footer">
            <span>Result:</span>
            <button class="run-btn">Run</button>
          </div>
        </div>

        <hr />

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå -->
        <div class="comment-section">
          <h4>‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h4>
          <textarea class="comment-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."></textarea>

          <div class="code-block comment-code">
            <div class="code-header">Python</div>
            <textarea class="code-content" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
            <div class="code-footer">
              <span>Result:</span>
              <button class="run-btn">Run</button>
            </div>
          </div>

          <div class="comment-actions">
            <button class="img-btn">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
            <button class="submit-comment">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</button>
          </div>
        </div>

        <hr />

        <!-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
        <div class="all-comments">
          <div class="single-comment">
            <img src="/user.png" class="comment-avatar" alt="" />
            <!-- <img src="../../public/user.png" class="comment-avatar" alt="" /> -->
            <div class="comment-content">
              <h5>Alan Tourpattaya <span class="like-count">911 Likes</span></h5>
              <p>Bro cook</p>

              <div class="code-block small-code">
                <div class="code-header">Python</div>
                <pre class="code-content">while True:
  print("brocooked üíÄüíÄüíÄ")</pre>
                <div class="code-footer">
                  <span>Result:</span>
                  <button class="run-btn">Run</button>
                </div>
              </div>

              <button class="like-btn">Like</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Popup modal -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal">
      <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</h2>
      <input type="text" id="category-name" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà..." />
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancel-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="modal-btn" id="save-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </div>

  <script>
    // helper to read cookie (non httpOnly)
    function readCookie(name) {
      const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
      return v ? decodeURIComponent(v.pop()) : null;
    }
    
    // get user from cookie and set username in UI
    let currentUser = null;
    const userCookie = readCookie('user');
    if (userCookie) {
      try { currentUser = JSON.parse(userCookie); } catch (e) { currentUser = null; }
    }
    if (currentUser && currentUser.username) {
      const unameEl = document.getElementById('username');
      if (unameEl) unameEl.textContent = currentUser.username;
    }

    // Sidebar profile click
    document.querySelector('.sidebar .avatar').addEventListener('click', () => {
      window.location.href = '/profile';
    });

    // ‡πÄ‡∏õ‡∏¥‡∏î popup
    const modal = document.getElementById("modal-overlay");
    document.querySelector(".new-category-btn").addEventListener("click", () => {
      modal.style.display = "flex";
      document.getElementById("category-name").focus();
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    document.getElementById("cancel-btn").addEventListener("click", () => {
      modal.style.display = "none";
      document.getElementById("category-name").value = "";
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    document.getElementById("save-btn").addEventListener("click", () => {
      const name = document.getElementById("category-name").value.trim();
      if (name) {
        const ul = document.querySelector(".category-list");
        const li = document.createElement("li");
        li.textContent = name;
        ul.appendChild(li);
        document.getElementById("category-name").value = "";
        modal.style.display = "none";
      }
    });
    async function fetchCategories() {
      const res = await fetch('/categories', { credentials: 'include' });
      categories = await res.json();
      renderCategories();
    }

    function renderCategories() {
      const list = document.getElementById('category-list');
      list.innerHTML = '';
      categories.forEach(cat => {
        const li = document.createElement('li');
        li.textContent = cat.name;
        li.addEventListener('click', () => {
          // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ homepage ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á categoryId ‡πÄ‡∏õ‡πá‡∏ô query string
          window.location.href = `/?categoryId=${encodeURIComponent(cat.id)}`;
        });
        list.appendChild(li);
      });
    }

    // Initial load
    fetchCategories();
  </script>
</body>

</html>